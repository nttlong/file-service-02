kind: Namespace
apiVersion: v1
metadata:
  name: fs-svc
  labels:
    name: fs-svc
#Enables the pods in a deployment to be accessible from outside the cluster
---
apiVersion: v1
kind: Service
metadata:
  name: file-services-api-svc
  namespace: fs-svc
spec:
  selector:
    app: file-services-api
  type: ClusterIP
#  portForward:
#    - protocol: "TCP"
#      port: 8011
#      localPort: 9000
  ports:
    - protocol: "TCP"
      port: 80
      targetPort: 8080
      name: file-services-api
#      nodePort: 30004
#  type: LoadBalancer
#  loadBalancerIP: 172.16.7.242
---
# Deploy web api
apiVersion: apps/v1
kind: Deployment
metadata:
  name: file-services-api
  namespace: fs-svc
  labels:
    app: file-services-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: file-services-api
  template:
    metadata:
      labels:
        app: file-services-api
    spec:
      containers:
        #command: python3 /app/uvicorn_start.py
        #host_name=172.16.13.72
          #host_port=8011
          #host_dir=
          #binding_port=80 db.host=192.168.18.36
          # db.port=27018 db.username=admin-doc
          #db.password=123456
          #db.authSource=lv-docs
          #admin_db_name=lv-docs
          #elastic_search.server=http://192.168.18.36:9200 elastic_search.prefix_index=lv-codx  w:10
        - args:
            - python3
            - /app/uvicorn_start.py
            - host_name=test-oms.qtsc.com.vn
            - host_port=80
            - host_dir=lvfile
            - binding_port:80
            - db.host=10.200.16.15
            - db.port=27018
            - db.username=admin
            - db.password=Lacviet#123
            - db.authSource=admin
            - admin_db_name=admin
            - elastic_search.server=http://10.200.16.16:9200
            - elastic_search.prefix_index=qtsc-codx
            - w:10


          env:
            - name: file_server_api_url
              value: http://test-oms.qtsc.com.vn/lvfile/api
            - name: file_server_bind_ip
              value: 0.0.0.0
            - name: file_server_bind_port
              value: "8080"
            - name: file_server_db_auth_source
              value: admin
            - name: file_server_db_host
              value: 10.200.16.15
            - name: file_server_db_password
              value: "Lacviet#123"
            - name: file_server_db_port
              value: "27017"
            - name: file_server_db_replica_set
            - name: file_server_db_username
              value: admin
            - name: file_server_es_url
              value: 'http://10.200.16.16:9200,'
            - name: file_server_root_url
              value: http://test-oms.qtsc.com.vn/lvfile/
            - name: file_server_use_os_config
              value: '''true'''
          image: nttlong/lv-file:rc.0.0.6
          name: file-services-api
          imagePullPolicy: Always
          ports:
            - containerPort: 80
          resources: { }
          volumeMounts:
          - name: tmp-upload
            mountPath: /app/tmp
          - name: fs-docs
            mountPath: /app/fs-docs
          - name: api-logs
            mountPath: /app/logs


      volumes:
       - name: tmp-upload
         hostPath: # hostPath volume
           path: /file-api # folder of worker node
       - name: fs-docs
         hostPath: # hostPath volume
           path: /fs-docs # folder of worker node
       - name: api-logs
         hostPath:
           path: /api_logs
       - name: fs-logs
         hostPath:
           path: /fs-logs
       - name: bk-logs
         hostPath:
           path: /fs_process_logs


